; EXPECT: loop nesting with inner function call and accumulator return
target triple = "unknown-unknown-unknown"
target datalayout = ""

declare i32 @helper(i32)

define i32 @loop_with_call(i32 %limit) {
entry.0:
    %i.addr.0 = alloca i32
    %acc.addr.0 = alloca i32
    store i32 0, ptr %i.addr.0
    store i32 0, ptr %acc.addr.0
    br label %loop.cond.0

loop.cond.0:
    %i.val.0 = load i32, ptr %i.addr.0
    %has_next.0 = icmp slt i32 %i.val.0, %limit
    br i1 %has_next.0, label %loop.body.0, label %loop.exit.0

loop.body.0:
    %call.0 = call i32 @helper(i32 %i.val.0)
    %acc.0 = load i32, ptr %acc.addr.0
    %new.acc.0 = add i32 %acc.0, %call.0
    store i32 %new.acc.0, ptr %acc.addr.0
    %inc.0 = add i32 %i.val.0, 1
    store i32 %inc.0, ptr %i.addr.0
    br label %loop.cond.0

loop.exit.0:
    %result.0 = load i32, ptr %acc.addr.0
    ret i32 %result.0
}
